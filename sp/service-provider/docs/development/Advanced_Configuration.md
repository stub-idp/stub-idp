## Advanced Configuration for the Verify Service Provider

During development, you may find you need to make use of advanced configuration options, which are not expected to
be used by relying parties in general. Available options are documented here.

### Startup Defaults
The `startup.sh` script has a few options for different use cases. 

Running `./startup.sh` with no arguments will start the application using the configuration file at `verify-service-provider.yml`, which assumes that you have either edited that file (temporarily) or set environment variables for the basic configuration options. 

Running `./startup.sh vsp-only` uses default values for the basic configuration options, given in `local-running/local-vsp-only.env`. Use this for running against compliance tool. These values match those set up using `scripts/init-compliance-tool-for-environment.sh local`.

Running `./startup.sh local-fed` uses your `local.env` file (generated by [verify-local-startup](https://github.com/alphagov/verify-local-startup)) to start  the Verify Service Provider against a locally running federation.

### Hub Configuration

You can override the hubSsoLocation and the hub metadata configuration in a configuration yaml file by adding to the
verifyHubConfiguration section as follows:
```
verifyHubConfiguration:
  environment: ... # Required.
  hubSsoLocation: ... # The location where Verify Hub authentication flow begins, e.g. https://www.integration.signin.service.gov.uk/SAML2/SSO
  metadata:
    uri: ... # The location of hub metadata, e.g. https://www.integration.signin.service.gov.uk/SAML2/metadata/federation
    expectedEntityId: ... # i.e. of hub (e.g. https://signin.service.gov.uk)
    trustStore: # See below
    minRefreshDelay: ...
    maxRefreshDelay: ...
    jerseyClientConfiguration: ...
    jerseyClientName: ...
```

There are two options for trust store configuration if it is provided.
```
trustStore:
  type: file # Optional, as this is the default
  path: ... # Path to file
  password: ...
```
or
```
trustStore:
  type: encoded
  store: ... # Base 64 encoded trust store
  password: ...
```

`path` and `password` or `type: encoded`, `store`, and `password` are all required to be specified if `trustStore` is specified.

`environment` is, as always, required to be specified, and must be one of PRODUCTION, INTEGRATION, or COMPLIANCE_TOOL.
Other values are all optional overrides, and will default to values based on the chosen environment. Values need only
be specified for these if you do not wish to use the default value for the chosen environment.

### MSA Metadata Configuration

You can override some properties of the MSA metadata configuration in a configuration yaml file by adding to the
msaMetadata section as follows:
```
msaMetadata:
  uri: ... # Required
  expectedEntityId: ... # Required
  minRefreshDelay: ...
  maxRefreshDelay: ...
  jerseyClientConfiguration: ...
  jerseyClientName: ...
```

Note there are no trust stores for the MSA metadata, since it is not signed. Default values will be used for any
of the above non-required options which do not have values specified.

